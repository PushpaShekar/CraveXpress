# Render Deployment Guide for CraveXpress

## Overview
This guide explains how to deploy the CraveXpress backend API to Render.com.

## Key Fixes Applied

### 1. ✅ Fixed Missing `dist` Folder Issue
**Problem**: The `dist` folder doesn't exist in the repository.
**Solution**: This is **NORMAL** and **CORRECT**! The `dist` folder is:
- Generated during the build process by TypeScript compiler (`tsc`)
- Excluded from git (as it should be)
- Created automatically when `npm run build` runs

### 2. ✅ Updated Build Configuration
**Changes in `render.yaml`:**
- Removed `rootDir` directive (can cause path issues)
- Changed build command to: `cd server && npm install && npm run build`
- Changed start command to: `cd server && npm start`
- Updated PORT from 5000 to 10000 (Render's default)
- Added missing Cloudinary environment variables

### 3. ✅ Improved TypeScript Configuration
**Changes in `server/tsconfig.json`:**
- Added explicit `rootDir: "./src"` to ensure clean output structure
- Removed unnecessary `declaration` and `declarationMap` options
- Kept source maps for better debugging

## Project Structure

```
CraveXpress/
├── client/               # React frontend (not deployed to Render)
├── server/              # Express backend (deployed to Render)
│   ├── src/            # TypeScript source files
│   ├── dist/           # ⚠️ Generated during build (not in git)
│   ├── package.json
│   └── tsconfig.json
├── types/              # Shared TypeScript types
└── render.yaml         # Render deployment configuration
```

## Deployment Steps

### Step 1: Prerequisites
- [ ] GitHub repository with your code
- [ ] Render.com account (free tier available)
- [ ] MongoDB Atlas database (or other MongoDB provider)

### Step 2: Prepare MongoDB Database
1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free cluster
3. Create a database user with password
4. Whitelist all IP addresses (0.0.0.0/0) for Render access
5. Get your connection string (should look like):
   ```
   mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/cravexpress?retryWrites=true&w=majority
   ```

### Step 3: Deploy to Render

#### Option A: Using Blueprint (render.yaml) - RECOMMENDED
1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** → **"Blueprint"**
3. Connect your GitHub repository
4. Render will detect `render.yaml` automatically
5. Click **"Apply"**
6. Fill in the required environment variables:
   - `MONGODB_URI`: Your MongoDB connection string
   - `GOOGLE_CLIENT_ID`: Google OAuth client ID (optional)
   - `GOOGLE_CLIENT_SECRET`: Google OAuth client secret (optional)
   - `GOOGLE_CALLBACK_URL`: e.g., `https://cravexpress-api.onrender.com/api/auth/google/callback`
   - `STRIPE_SECRET_KEY`: Your Stripe secret key
   - `STRIPE_WEBHOOK_SECRET`: Your Stripe webhook secret
   - `CLIENT_URL`: Your frontend URL (e.g., Vercel deployment URL)
   - `CLOUDINARY_CLOUD_NAME`: Your Cloudinary cloud name (optional)
   - `CLOUDINARY_API_KEY`: Your Cloudinary API key (optional)
   - `CLOUDINARY_API_SECRET`: Your Cloudinary API secret (optional)

#### Option B: Manual Setup
1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** → **"Web Service"**
3. Connect your GitHub repository
4. Configure:
   - **Name**: `cravexpress-api`
   - **Environment**: `Node`
   - **Region**: Choose closest to your users
   - **Branch**: `main`
   - **Build Command**: `cd server && npm install && npm run build`
   - **Start Command**: `cd server && npm start`
   - **Plan**: Free
5. Add environment variables (same as above)
6. Click **"Create Web Service"**

### Step 4: Monitor Deployment
1. Watch the build logs in real-time
2. Build process will:
   - Install dependencies
   - Compile TypeScript → JavaScript
   - Create `dist` folder
   - Start the server

### Step 5: Verify Deployment
1. Once deployed, visit: `https://your-service-name.onrender.com/api/health`
2. You should see: `{"status":"ok","message":"Server is running"}`

## Environment Variables Reference

### Required
| Variable | Description | Example |
|----------|-------------|---------|
| `NODE_ENV` | Environment mode | `production` |
| `PORT` | Server port | `10000` (Render default) |
| `MONGODB_URI` | MongoDB connection string | `mongodb+srv://...` |
| `JWT_SECRET` | JWT signing secret | Auto-generated by Render |
| `JWT_EXPIRE` | JWT expiration time | `7d` |

### Optional (for full features)
| Variable | Description | Where to get |
|----------|-------------|--------------|
| `GOOGLE_CLIENT_ID` | Google OAuth | [Google Cloud Console](https://console.cloud.google.com/) |
| `GOOGLE_CLIENT_SECRET` | Google OAuth | [Google Cloud Console](https://console.cloud.google.com/) |
| `GOOGLE_CALLBACK_URL` | Google OAuth callback | `https://your-api.onrender.com/api/auth/google/callback` |
| `STRIPE_SECRET_KEY` | Stripe payments | [Stripe Dashboard](https://dashboard.stripe.com/) |
| `STRIPE_WEBHOOK_SECRET` | Stripe webhooks | [Stripe Webhooks](https://dashboard.stripe.com/webhooks) |
| `CLIENT_URL` | Frontend URL | Your Vercel/Netlify URL |
| `CLOUDINARY_CLOUD_NAME` | Image hosting | [Cloudinary](https://cloudinary.com/) |
| `CLOUDINARY_API_KEY` | Image hosting | [Cloudinary](https://cloudinary.com/) |
| `CLOUDINARY_API_SECRET` | Image hosting | [Cloudinary](https://cloudinary.com/) |

## Common Issues & Solutions

### ❌ Issue: "dist folder is missing"
**Solution**: This is normal! The `dist` folder is created during build. Make sure:
- Build command includes `npm run build`
- TypeScript is in devDependencies
- Build logs show successful compilation

### ❌ Issue: "Module not found"
**Solution**: 
- Check that all dependencies are in `package.json`
- Ensure `npm install` runs in build command
- Verify TypeScript paths are correct

### ❌ Issue: "Build failed"
**Solution**:
- Check build logs for specific errors
- Ensure all TypeScript files compile without errors
- Verify `tsconfig.json` is correct

### ❌ Issue: "Health check failed"
**Solution**:
- Verify server starts on `PORT` environment variable
- Check that `/api/health` endpoint exists
- Review application logs

### ❌ Issue: "Database connection failed"
**Solution**:
- Verify `MONGODB_URI` is correct
- Check MongoDB Atlas IP whitelist includes 0.0.0.0/0
- Ensure database user has correct permissions

## Testing Locally Before Deploy

Run these commands to test the build process locally:

```bash
# Navigate to server directory
cd server

# Install dependencies
npm install

# Build TypeScript
npm run build

# Check that dist folder was created
ls dist

# Start the server
npm start
```

## Updating Deployment

When you push changes to GitHub:
1. Render automatically detects changes
2. Triggers a new build
3. Deploys the new version
4. Zero-downtime deployment (on paid plans)

## Free Tier Limitations

Render's free tier:
- ✅ 750 hours/month (enough for 1 service)
- ✅ Automatic SSL certificates
- ✅ Custom domains
- ⚠️ Spins down after 15 minutes of inactivity
- ⚠️ Cold start takes ~30 seconds
- ⚠️ 512 MB RAM limit

## Next Steps

1. ✅ Deploy backend to Render
2. ✅ Deploy frontend to Vercel/Netlify
3. ✅ Update `CLIENT_URL` in Render environment variables
4. ✅ Update API URL in frontend (`.env` file)
5. ✅ Set up custom domain (optional)
6. ✅ Configure Google OAuth redirect URLs
7. ✅ Configure Stripe webhook endpoint

## Support

If you encounter issues:
1. Check Render's build and runtime logs
2. Review this guide's "Common Issues" section
3. Check `RENDER_DEPLOYMENT_FIXES_SUMMARY.md` for technical details
4. Visit [Render Documentation](https://render.com/docs)

---

**Last Updated**: November 2025
**Status**: ✅ Ready for deployment

